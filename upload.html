<!DOCTYPE html>
<html lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Capstone GRS</title>

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,800' rel='stylesheet' type='text/css'>
    
    <link rel="stylesheet" href="/capstone-grs/css/bootstrap.min.css">
    <link rel="stylesheet" href="/capstone-grs/css/bootstrap-table.css">
    <link rel="stylesheet" href="/capstone-grs/css/main.css">

    <script src="/capstone-grs/js/jquery.min.js"></script>
    <script src="/capstone-grs/js/bootstrap.min.js"></script>
    <script src="/capstone-grs/js/bootstrap-table.js"></script>
    <script src="/capstone-grs/js/bootstrap-table-export.js"></script>        
    <script src="/capstone-grs/js//tableExport.js"></script>   
    <script language="javascript" id="_fed_an_ua_tag" src="/capstone-grs/js/Universal-Federated-Analytics.1.0.js?agency=NARA&subagency=GITHUB"></script> 
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>

  <body>
    <div class="container">

      <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <img alt="National Archives and Records Administration" src="/capstone-grs/img/nara-logo.png">
      </span>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
          <li><a href="/capstone-grs/index.html#about">Home</a></li>
          <li><a href="/capstone-grs/index.html#explore">Explore Submissions</a></li>
          <li><a href="/capstone-grs/api/forms.html">Search Data</a></li>
     			<li><a href="/capstone-grs/index.html#additional">Additional Resources</a></li>     			          
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <!-- David can I just delete the demo data line below OK? -->
                        
      </ul>            
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>


<script src="/capstone-grs/js/jquery-2.1.3.js"></script>
<script src="/capstone-grs/js/oauth.js"></script>
<script src="/capstone-grs/js/github.js"></script>
<script>    
  var access_token;  
  var filename;
  var raw_data;

  var reader = new FileReader();
  reader.onload = function(e) {
    raw_data = base64ArrayBuffer(e.target.result);
  };
  reader.onerror = function(e) {
    console.log("Error", e);  
  };

  $(document).ready(function() {
    access_token = $.urlParam('access_token');

    if(access_token !=  null) {
      document.getElementById('access_token').value = access_token;    
      document.getElementById("login").style.display = 'none';      
    }  
    else {
      document.getElementById("save").style.display = 'none';
      document.getElementById("login").style.display = '';
    }  

    $("#the-file-input").change(function() {                      
      if (this.files[0].type.match(/.(pdf)$/)) {
        filename = this.files[0].name;
        reader.readAsArrayBuffer(this.files[0]); 
        if(access_token !=  null) {
          document.getElementById("save").style.display = '';
        }
      } 
      else {
        console.log("File not supported.");
      }      
    });

  });

  $.urlParam = function(name) {
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    if (results==null) {
      return null;
    } 
    else {
      return results[1] || 0;
    }
  }

  function saveFile() {    
    var github = new Github({
      token: access_token,
      auth: "oauth"
    });

    var repo = github.getRepo('usnationalarchives', 'capstone-grs');
    var options = {
      encode: false // Whether to base64 encode the file. (default: true)
    }
    repo.write('master', 'forms/'+filename, raw_data, 
      'Saving data file ' + filename, options, function(e) {
      if (e) {
        console.log(e.error);
        alert('There was an error uploading the form. Please try again.');
      }
      else {
        window.location.href = "/capstone-grs/api/forms.html";
      }
      
    })
  }       

  function base64ArrayBuffer(arrayBuffer) {
    var base64    = ''
    var encodings = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'

    var bytes         = new Uint8Array(arrayBuffer)
    var byteLength    = bytes.byteLength
    var byteRemainder = byteLength % 3
    var mainLength    = byteLength - byteRemainder

    var a, b, c, d
    var chunk

    // Main loop deals with bytes in chunks of 3
    for (var i = 0; i < mainLength; i = i + 3) {
      // Combine the three bytes into a single integer
      chunk = (bytes[i] << 16) | (bytes[i + 1] << 8) | bytes[i + 2]

      // Use bitmasks to extract 6-bit segments from the triplet
      a = (chunk & 16515072) >> 18 // 16515072 = (2^6 - 1) << 18
      b = (chunk & 258048)   >> 12 // 258048   = (2^6 - 1) << 12
      c = (chunk & 4032)     >>  6 // 4032     = (2^6 - 1) << 6
      d = chunk & 63               // 63       = 2^6 - 1

      // Convert the raw binary segments to the appropriate ASCII encoding
      base64 += encodings[a] + encodings[b] + encodings[c] + encodings[d]
    }

    // Deal with the remaining bytes and padding
    if (byteRemainder == 1) {
      chunk = bytes[mainLength]

      a = (chunk & 252) >> 2 // 252 = (2^6 - 1) << 2

      // Set the 4 least significant bits to zero
      b = (chunk & 3)   << 4 // 3   = 2^2 - 1

      base64 += encodings[a] + encodings[b] + '=='
    } else if (byteRemainder == 2) {
      chunk = (bytes[mainLength] << 8) | bytes[mainLength + 1]

      a = (chunk & 64512) >> 10 // 64512 = (2^6 - 1) << 10
      b = (chunk & 1008)  >>  4 // 1008  = (2^6 - 1) << 4

      // Set the 2 least significant bits to zero
      c = (chunk & 15)    <<  2 // 15    = 2^4 - 1

      base64 += encodings[a] + encodings[b] + encodings[c] + '='
    }
    
    return base64
  }

</script>  


<div class="col-md-12">
  <div class="row">

    <div id="login" style="display: none;">  
      <p align="center">
        <a href="/capstone-grs/login.html">Login</a>
      </p>
    </div>
    
    <p align="center">
  	  <input id="the-file-input" type="file">
      <input id="access_token" type="hidden">
    </p>

    <p>
      <div id="save" style="display: none;"> 
        <p align="center"><a href="#" onclick="saveFile();">Save</a></p>
      </div>    
    </p>
  </div>
</div>

  


  
      <!-- footer -->
      <footer class="footer">
        <div class="col-md-12">
          <div class="row">
            <hr/>
            <div class="col-sm-4">
              <ul class="footer">
                <li>
                  <a href="http://www.archives.gov/foia/">Freedom of Information Act</a>
                </li>
                <li>
                  <a href="http://www.archives.gov/eeo/policy/complaint-activity.html">No FEAR Act</a>
                </li>
                <li>
                  <a href="http://www.archives.gov/global-pages/privacy.html">Privacy Policy</a>                  
                </li>                
              </ul>
            </div>
            
            <div class="col-sm-4">
              <ul class="footer">
                <li>                  
                  <a href="http://www.archives.gov/" alt="The U.S. National Archives and Records Administration">
                    <img alt="National Archives and Records Administration"src="/capstone-grs/img/nara-logo.png">
                  </a>
                </li>
                <li>1-86-NARA-NARA or 1-866-272-6272</li>
              </ul>
            </div>
            
            <div class="col-sm-4">
              <ul class="footer">
                <li>
                  <a href="https://www.archives.gov/contact/">Contact Us</a>
                </li>
                <li>
                  <a href="http://www.usa.gov/">USA.gov</a>
                </li>
                <li>
                  <a href="http://www.archives.gov/global-pages/accessibility.html">Accessibility</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </footer>
      <!-- /footer -->
    </div>


    <script type="text/javascript">
      function getLinkUrl(partial, str) {
        if(!str) {
          return "";
        }
        else if (/^https?:\/\//i.test(str)) {
          return '<a href="' + str + '" target="_blank">' + str + '</a>';
        }
        else {
          return '<a href="' + partial + '/' + sanitizeString(str) + '.html">' + str + '</a>';
        }
      };

      function sanitizeString(str) {
        if (str) {
          var new_str = str.replace(/[\s+-]/gm, "-");
          new_str = new_str.replace(/[^\w-]/gm, "-");          
          new_str = new_str.replace(/\-+/gm, '-');
          new_str = new_str.toLowerCase();
          new_str = new_str.slice(0, 51);
          new_str = new_str.replace(/\-+$/gm, '');

          return new_str;
        }
        else {
          return str;
        }        
      };

    </script>
  </body>
</html>



